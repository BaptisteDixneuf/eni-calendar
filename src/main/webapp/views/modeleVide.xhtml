<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<link
		href="#{request.contextPath}/style/bootstrap/css/bootstrap.min.css"
		rel="stylesheet" id="bootstrap-css" />
	<script type="text/javascript"
		src="#{request.contextPath}/style/bootstrap/js/bootstrap.min.js"></script>
</h:head>


<body>
	<ui:include src="menuBis.xhtml"></ui:include>

	<script type="text/javascript">
	    function handleDrop(event, ui) {
	        var droppedElementCalendrier = ui.draggable;
	 
	        droppedElementCalendrier.fadeOut('fast');
	    }
	</script>

	<h:form id="coursForm">
		
		<h:panelGroup id="preFormulaire">
			<p:messages for="general"/>

			<!-- Début du préformulaire -->
			<div class="ui-g">				
				<!-- Marge à gauche -->
				<div class="ui-g-3"></div>
				
				<!-- Contenu centré -->
				<div class="ui-g-6">
					<div class="ui-g">
						<div class="ui-g-6">
							<p:outputLabel for="formation" value="Formation :" />
							<p:selectOneMenu id="formation" disabled="#{modeleVideController.preFormulaireValide}"
								value="#{modeleVideController.codeFormation}">
								<f:selectItem itemLabel="Selectionner une formation" itemValue="" />
								<f:selectItems value="#{modeleVideController.formations}"
									var="formation" itemLabel="#{formation.libelleCourt}"
									itemValue="#{formation.codeFormation}" />
							</p:selectOneMenu>
							<p:messages for="formation"></p:messages>
						</div>
						<div class="ui-g-6">
							<p:outputLabel for="lieuFormation" value="Lieu de formation :" />
							<p:selectOneMenu id="lieuFormation" disabled="#{modeleVideController.preFormulaireValide}"
								value="#{modeleVideController.codeLieuFormation}">
								<f:selectItem itemLabel="Selectionner un lieu" itemValue="" />
								<f:selectItems value="#{modeleVideController.lieux}" var="lieu"
									itemLabel="#{lieu.libelle}" itemValue="#{lieu.codeLieu}" />
							</p:selectOneMenu>
							<p:messages for="lieuFormation"></p:messages>	
						</div>
					</div>
					<div class="ui-g">
						<div class="ui-g-6">
							<p:outputLabel for="dateDebut" value="Date de début :" />
							<p:calendar id="dateDebut" disabled="#{modeleVideController.preFormulaireValide}"
								value="#{modeleVideController.dateDebut}" locale="fr"
								navigator="true" pattern="dd/MM/yyyy" />
							<p:messages for="dateDebut"></p:messages>
						</div>
						<div class="ui-g-6">
							<p:commandButton styleClass="m-l-25" id="creer" value="Créer" action="#{modeleVideController.creer}" update=":coursForm" disabled="#{modeleVideController.preFormulaireValide}"></p:commandButton>
						</div>
					</div>
				</div>
				<!-- Marge à droite -->
				<div class="ui-g-3"></div>
			</div>
			<!-- Fin du préformualire -->
		</h:panelGroup>
		
		<h:panelGroup id="panelCalendrier">	
			<h:panelGroup rendered="#{modeleVideController.preFormulaireValide}">
				<!-- Tableau de programmation -->
				<div class="ui-g">
					<!--  Liste des cours disponibles -->
					<div class="ui-g-6">
						<p:dataTable id="availableElementCalendrier" var="element"
							value="#{modeleVideController.availableElementCalendrier}">	
	
							<p:column rendered="#{!element.moduleProgramme}">
								<p:panel id="gpnl">
									<h:outputText value="#{element.libelle}"></h:outputText> - 
				               		<h:outputText value="#{element.dateDebut}"></h:outputText> -
				               		<h:outputText value="#{element.dateFin}"></h:outputText>
	
								</p:panel>
								<p:draggable for="gpnl" revert="true" helper="clone"
									disabled="#{element.moduleProgramme}" />
							</p:column>
	
	
						</p:dataTable>
					</div>
	
					<!-- Listes des cours sélectionnées -->
					<div class="ui-g-6">
						<p:fieldset id="selectedElementCalendrier">
							<p:outputPanel id="dropArea">
								<h:outputText value="Aucun éléments"
									rendered="#{empty modeleVideController.droppedElementCalendrier}"
									style="font-size:24px;" />
								<p:dataTable id="selectedCoursTable" var="element"
									value="#{modeleVideController.droppedElementCalendrier}"
									rendered="#{not empty modeleVideController.droppedElementCalendrier}">
									<p:column>
										<h:outputText value="#{element.libelle}"></h:outputText> - 
		               			<h:outputText value="#{element.dateDebut}"></h:outputText> -
		               			<h:outputText value="#{element.dateFin}"></h:outputText>
										<p:commandButton id="deprogrammer" value="Déprogrammer"
											action="#{modeleVideController.deprogrammer(element)}"
											update=":coursForm:panelCalendrier"></p:commandButton>
									</p:column>
								</p:dataTable>
							</p:outputPanel>
						</p:fieldset>
					</div>
	
					<p:droppable for="selectedElementCalendrier" tolerance="touch"
						activeStyleClass="ui-state-highlight"
						datasource="availableElementCalendrier" onDrop="handleDrop">
						<p:ajax
							listener="#{modeleVideController.onElementCalendrierDrop}"
							update="dropArea availableElementCalendrier" />
					</p:droppable>
	
				</div>
			</h:panelGroup>
		</h:panelGroup>
		
		<!-- Barre -->
		<h:panelGroup rendered="#{modeleVideController.preFormulaireValide}">
		
			<!-- Barre plier -->
			<div id="groupeConteneur">			
				<div class="paveGroupe">
					<div class="pull-l">
						<!-- Mettre à gauche -->
						<h:panelGroup class="informationGroupeGUI m-t-15 m-l-50">
	
							<!-- Bouton + -->
							<h:panelGroup styleClass="informationGroupeBoutonGui">
								<p:commandLink id="plierDeplierPaveGroupeButton"
									styleClass="icn_open" oncomplete="PF('modalGroupe').show();">
									<i class="fa fa-plus-circle boutonPlierGUI"></i>
								</p:commandLink>
							</h:panelGroup>
	
							<!-- Libelle de la barre fixe-->
							<h:panelGroup styleClass="informationGroupeTitreGui  m-l-10">							
							 		#{modeleVideController.selectedFormation.libelleCourt} - #{modeleVideController.selectedLieu.libelle} - #{modeleVideController.formatDate(modeleVideController.dateDebut)}	 		
								</h:panelGroup>
						</h:panelGroup>
						
						<p:commandButton styleClass="m-l-25" id="enregistrer" value="Enregistrer" action="#{modeleVideController.save}" update=":coursForm:panelCalendrier"></p:commandButton>
					</div>
				</div>
			</div>
			
			<!-- Barre déplier -->
			<p:dialog id="paveGroupeDeplier" header="Modal Dialog"
				widgetVar="modalGroupe" modal="true" appendToBody="true" width="100%"
				position="bottom" closable="false" height="500" resizable="false"
				draggable="false">
	
	
				<!-- Header -->
				<f:facet name="header">
					<div class="paveGroupe" onclick="PF('modalGroupe').hide();">
	
						<div class="pull-l">
							<h:panelGroup class="informationGroupeGUI m-t-15 m-l-50">
								<h:panelGroup styleClass="informationGroupeBoutonGui">
									<p:commandLink id="closeTutututu">
										<i class="fa fa-minus-circle boutonPlierGUI" aria-hidden="true"></i>
									</p:commandLink>
								</h:panelGroup>
	
								<h:panelGroup styleClass="informationGroupeTitreGui  m-l-10">
									#{modeleVideController.selectedFormation.libelleCourt} - #{modeleVideController.selectedLieu.libelle} - #{modeleVideController.formatDate(modeleVideController.dateDebut)}
								</h:panelGroup>
							</h:panelGroup>
						</div>
	
					</div>
				</f:facet>
	
				<!-- Barre déplier - cONTENU -->
				<div id="blocGroupe">
	
					<p:tabView>
					
						<!-- Les contraintes -->
						<p:tab title="Contraintes">
							<h:outputText value="Les contraintes:" />
							
							<div class="m-t-20">								
								<p:selectBooleanCheckbox id="semaineAffileeEntreprise" value="#{modeleVideController.contraintesViewElement.semaineAffileeEntreprise}" />
								<p:outputLabel styleClass="m-l-20" for="semaineAffileeEntreprise" value="Nombre de semaine d'affilée en entreprise :  " />						
								<p:spinner styleClass="m-l-20" id="semaineAffileeEntrepriseNumber" value="#{modeleVideController.contraintesViewElement.semaineAffileeEntrepriseNombre}" min="0"/>
							</div>
							
							<div class="m-t-20">	
								<p:selectBooleanCheckbox id="semaineAffileeFormation" value="#{modeleVideController.contraintesViewElement.semaineAffileeFormation}" />
								<p:outputLabel styleClass="m-l-20" for="semaineAffileeFormation" value="Nombre de semaine d'affilée en formation : " />						
								<p:spinner styleClass="m-l-20" id="semaineAffileeFormationNumber" value="#{modeleVideController.contraintesViewElement.semaineAffileeFormationNombre}" min="0"/>
							</div>
							
							<div class="m-t-20">	
								<p:selectBooleanCheckbox id="periodeForteActiviteEntreprise" value="#{modeleVideController.contraintesViewElement.periodeForteActiviteEntreprise}" />
								<p:outputLabel styleClass="m-l-20" for="periodeForteActiviteEntreprise" value="Périodes de forte activité en entreprise :  " />
								<p:dataTable var="forte" value="#{modeleVideController.contraintesViewElement.listPeriodeForteActiviteEntreprise}" 
									rendered="#{not empty modeleVideController.contraintesViewElement.listPeriodeForteActiviteEntreprise}"
								 	emptyMessage="Aucun enregistrement">
									<p:column>
										#{modeleVideController.formatDate(forte.dateDebut)}
										#{modeleVideController.formatDate(forte.dateFin)}
									</p:column>
								</p:dataTable>
								<div>
									<p:calendar id="periodeForteActiviteEntrepriseDateDebut" value="#{modeleVideController.contraintesViewElement.periodeForteActiviteEntrepriseDateDebut}" showOn="button"/>
									<p:calendar id="periodeForteActiviteEntrepriseDateFin" value="#{modeleVideController.contraintesViewElement.periodeForteActiviteEntrepriseDateFin}" showOn="button"/>
								</div>
							</div>
							
							<div class="m-t-20">	
								<p:selectBooleanCheckbox id="periodeFaibleActiviteEntreprise" value="#{modeleVideController.contraintesViewElement.periodeFaibleActiviteEntreprise}" />
								<p:outputLabel styleClass="m-l-20" for="periodeFaibleActiviteEntreprise" value="Périodes de faible activité en entreprise :  " />
								<p:dataTable var="faible" value="#{modeleVideController.contraintesViewElement.listPeriodeFaibleActiviteEntreprise}"  
									rendered="#{not empty modeleVideController.contraintesViewElement.listPeriodeFaibleActiviteEntreprise}"
									emptyMessage="Aucun enregistrement">
									<p:column>
										#{modeleVideController.formatDate(faible.dateDebut)}
										#{modeleVideController.formatDate(faible.dateFin)}
									</p:column>
								</p:dataTable>
								<div>
									<p:calendar id="periodeFaibleActiviteEntrepriseDateDebut" value="#{modeleVideController.contraintesViewElement.periodeFaibleActiviteEntrepriseDateDebut}" showOn="button" />
									<p:calendar id="periodeFaibleActiviteEntrepriseDateFin" value="#{modeleVideController.contraintesViewElement.periodeFaibleActiviteEntrepriseDateFin}" showOn="button" />
								</div>
							</div>
							
							<div class="m-t-20">	
								<p:selectBooleanCheckbox id="periodeNonDisponibiliteStagiaire" value="#{modeleVideController.contraintesViewElement.periodeNonDisponibiliteStagiaire}" />
								<p:outputLabel styleClass="m-l-20" for="periodeNonDisponibiliteStagiaire" value="Périodes de non disponibilité du stagiaire ( Absences ) :" />
								<p:dataTable var="absence" value="#{modeleVideController.contraintesViewElement.listPeriodeNonDisponibiliteStagiaire}"
									rendered="#{not empty modeleVideController.contraintesViewElement.listPeriodeNonDisponibiliteStagiaire}" 
									emptyMessage="Aucun enregistrement" >
									<p:column>
										#{modeleVideController.formatDate(absence.dateDebut)}
										#{modeleVideController.formatDate(absence.dateFin)}
										#{absence.motif}
									</p:column>
								</p:dataTable>								
								<div>
									<p:outputLabel for="periodeNonDisponibiliteStagiaireMotif" value="Motif : " />
									<p:inputText styleClass="m-l-20" id="periodeNonDisponibiliteStagiaireMotif" maxlength="255"
									value="#{modeleVideController.contraintesViewElement.periodeNonDisponibiliteStagiaireMotif}"></p:inputText>
								</div>
								<div>
									<p:calendar id="periodeNonDisponibiliteStagiaireDateDebut" value="#{modeleVideController.contraintesViewElement.periodeNonDisponibiliteStagiaireDateDebut}" showOn="button" />
									<p:calendar id="periodeNonDisponibiliteStagiaireDateFin" value="#{modeleVideController.contraintesViewElement.periodeNonDisponibiliteStagiaireDateFin}" showOn="button" />
								</div>
							</div>
							
							<p:commandButton styleClass="m-l-25" id="enregistrerContraintes" value="Enregistrer" action="#{modeleVideController.enregistrerContraintes}" update=":coursForm"></p:commandButton>
							
						</p:tab>
						
						<!-- Les dispenses -->
						<p:tab  title="Dispenses">
							<h:panelGroup id="tabDispenses">
								<h:outputText value="Les dispenses : " />
								<p:dataTable var="dispense" value="#{modeleVideController.dispensesViewElement.listDispenses}" emptyMessage="Aucune dispense">
									<p:column>
										<h:outputText value="#{dispense.libelle}"></h:outputText>
									</p:column>
								</p:dataTable>
								<p:autoComplete id="moduleAutocomplete" minQueryLength="3" value="#{modeleVideController.dispensesViewElement.selectedModule}" size="200"
									completeMethod="#{modeleVideController.autocompleteModule}"  converter="moduleConverter"
										var="moduleDispense" itemLabel="#{moduleDispense.libelle}" itemValue="#{moduleDispense}" forceSelection="true"/>
								<p:messages for="moduleAutocomplete"></p:messages>	
								<p:commandButton styleClass="m-t-10" id="ajouterDispense" value="Ajouter" action="#{modeleVideController.ajouterDispense}" update="tabDispenses"></p:commandButton>								
							</h:panelGroup>
							<p>	
								<p:commandButton styleClass="" id="enregistrerDispenses" value="Enregistrer" action="#{modeleVideController.enregistrerDispenses}" update=":coursForm"></p:commandButton>
							</p>	
						</p:tab>
						
						<!-- Les modules indépendants -->
						<p:tab title="Modules indépendants">
							<h:outputText value="Les modules indépendants : " />
							<p:dataTable var="moduleIndependant" value="#{modeleVideController.moduleIndependantsViewElement.listModuleIndependants}" emptyMessage="Aucun module indépendant">
								<p:column headerText="Libellé">
									<h:outputText value="#{moduleIndependant.libelle}"></h:outputText>
								</p:column>
								<p:column headerText="Actions">
									
								</p:column>
							</p:dataTable>
							<p:autoComplete id="moduleIndependantAutocomplete" minQueryLength="3" value="#{modeleVideController.moduleIndependantsViewElement.selectedModuleIndependant}" size="500"
							completeMethod="#{modeleVideController.autocompleteModuleIndependant}"  converter="moduleIndependantConverter"
									var="moduleIndependant" itemLabel="#{moduleIndependant.libelle}" itemValue="#{moduleIndependant}" forceSelection="true"/>
						</p:tab>
						
						<!-- Les autres cours -->
						<p:tab title="Autre cours">
							<h:outputText value="Les autres cours :" />
							<p:dataTable var="cours" value="#{modeleVideController.ensembleCours}"
								widgetVar="titreTable" emptyMessage="Auncun cours trouvé">
								<p:column headerText="Cours :" sortBy="#{cours.libelleCours}"
									filterBy="#{cours.libelleCours}">
									<h:outputText value="#{cours.module.libelle}" />
								</p:column>								
								<p:column headerText="Date début :" sortBy="#{cours.dateDebut}"
									filterBy="#{cours.dateDebut}">
									<h:outputText value="#{cours.dateDebut}" />
								</p:column>
								<p:column headerText="Date fin :" sortBy="#{cours.dateFin}"
									filterBy="#{cours.dateFin}">
									<h:outputText value="#{cours.dateFin}" />
								</p:column>													
							</p:dataTable>
						</p:tab>
					</p:tabView>
	
				</div>
			</p:dialog>
		</h:panelGroup>
	</h:form>
</body>
</html>